<div class="dashboard-container">
  <!-- Sidebar (reuse from hr-management) -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="assets/logo.png" alt="iDUELA" class="logo" />
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="section-title">Navigation</div>
        <div class="nav-item" (click)="navigateBack()">
          <span class="nav-icon"><i class="fas fa-arrow-left"></i></span>
          <span class="nav-text">Back to Management</span>
        </div>
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="page-name">Permission Management</div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
      <div class="page-header">
        <h1 class="page-title">Role Permission Management</h1>
        <p class="page-subtitle">Assign and manage permissions for different roles in the system</p>
      </div>

      <!-- Error/Success Messages -->
      <div *ngIf="errorMessage" class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        {{ errorMessage }}
      </div>
      <div *ngIf="successMessage" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        {{ successMessage }}
      </div>

      <!-- Role Selection -->
      <div class="role-selector-section">
        <h2 class="section-title">Select Role</h2>
        <div class="role-tabs">
          <button
            *ngFor="let role of roles"
            class="role-tab"
            [class.active]="selectedRoleId === role.id"
            (click)="selectRole(role.id)"
          >
            {{ role.role_name }}
          </button>
        </div>
        <p *ngIf="selectedRole" class="role-description">
          {{ selectedRole.description }}
        </p>
      </div>

      <!-- Permissions List -->
      <div *ngIf="selectedRoleId && !isLoading" class="permissions-section">
        <div class="permissions-header">
          <h2 class="section-title">Permissions for {{ selectedRole?.role_name }}</h2>
          <button
            class="btn-save"
            [disabled]="isSaving"
            (click)="saveRolePermissions()"
          >
            <i class="fas fa-save"></i>
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
        </div>

        <div *ngFor="let category of Object.keys(permissionsByCategory)" class="permission-category">
          <h3 class="category-title">{{ getCategoryDisplayName(category) }}</h3>
          <div class="permissions-grid">
            <label
              *ngFor="let permission of permissionsByCategory[category]"
              class="permission-item"
            >
              <input
                type="checkbox"
                [checked]="isPermissionAssigned(permission.id)"
                (change)="togglePermission(permission.id)"
                class="permission-checkbox"
              />
              <div class="permission-info">
                <span class="permission-name">{{ permission.name }}</span>
                <span class="permission-code">{{ permission.code }}</span>
                <span *ngIf="permission.description" class="permission-description">
                  {{ permission.description }}
                </span>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading permissions...</p>
      </div>

      <!-- No Role Selected -->
      <div *ngIf="!selectedRoleId && !isLoading" class="empty-state">
        <i class="fas fa-shield-alt"></i>
        <p>Please select a role to manage its permissions</p>
      </div>
    </div>
  </div>
</div>

